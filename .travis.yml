language: python
# use container-based infrastructure
sudo: required
services:
  - docker
cache:
  pip: true
  timeout: 1000
python:
  - "3.5"
bundler_args: --retry 9
# command to install dependencies, e.g. pip install -r requirements.txt --use-mirrors
install: 
 # Install git-lfs
 - cd ..
 - curl -sLo - https://github.com/github/git-lfs/releases/download/v1.4.1/git-lfs-linux-amd64-1.4.1.tar.gz | tar xzvf -
 - export PATH=$PATH:`pwd`/git-lfs-1.4.1
 - git lfs install  
 # Download data.
 - cd SwE-toolbox/test
 - git clone https://github.com/TomMaullin/SwE-toolbox-testdata.git data
 # Download testing tools
 - git clone https://github.com/MOxUnit/MOxUnit.git
 - cd ..
script:
 # Run docker snapshot of dev octave (until 4.4 is released)
 - did=$(sudo docker run -ti -d --rm -v `pwd`:/swe cmaumet/octave-spm)
 # Run tests in Octave
 - sudo docker exec -t -i $did bash -c "sudo chmod 755 /swe/runWB.sh; sudo /swe/runWB.sh;"
before_install:
 # Update docker version
 - sudo apt-get update
 - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
 - git config --global user.name "TravisCI"
 - git config --global user.email "travis@dummy.com"
 - docker pull cmaumet/octave-spm
